このCLAUDE.mdファイルは、Docker環境で動作するClaude CLIコンテナのための設定ファイルです。Claude CLIがmcp-obsidianサービスを介してObsidian Vaultにアクセスし、日本語小説執筆を支援するための指示が含まれています。

## プロジェクト概要
このプロジェクトは、Docker環境でClaude CLIとObsidianを連携させた日本語小説執筆システムです。Claude CLIコンテナからmcp-obsidianサービスを経由してObsidian Vaultの共有ボリュームにアクセスし、複数の作品を効率的に管理・執筆できる環境を提供します。各作品は独立したディレクトリで管理され、章と節による詳細な構造化により長編小説の執筆を支援します。

## 技術スタック
- **実行環境**: Docker Compose
- **執筆環境**: Obsidian (Dockerコンテナ)
- **AI支援**: Claude CLI (Dockerコンテナ)
- **MCPサーバー**: mcp-obsidian (Dockerサービス)
- **共有ストレージ**: Docker Volume
- **言語**: 日本語
- **形式**: Markdown

## Obsidian vault構造
```
/小説執筆/
├── /作品名_1/
│   ├── /設定資料/
│   │   ├── キャラクター設定.md
│   │   ├── 世界観設定.md
│   │   ├── タイムライン.md
│   │   └── 用語集.md
│   ├── /プロット/
│   │   ├── 全体構成.md
│   │   └── 章別概要.md
│   ├── /本文/
│   │   ├── /第1章/
│   │   │   ├── 第1節.md
│   │   │   ├── 第2節.md
│   │   │   ├── 第3節.md
│   │   │   └── 章メモ.md
│   │   ├── /第2章/
│   │   │   ├── 第1節.md
│   │   │   ├── 第2節.md
│   │   │   └── 章メモ.md
│   │   └── ...
│   └── /アイデアメモ/
│       └── ブレインストーミング.md
├── /作品名_2/
│   └── （同様の構造）
└── /共通資料/
    └── 執筆ガイドライン.md
```

## 執筆ルール

### 日本語小説の書式
- 文頭に全角スペースを入れる
- 数字は漢数字を使用（一、二、三）
- 三点リーダー「……」とダッシュ「――」は2つ続ける
- 会話文は「」で囲む
- 心内語は『』で囲む

### 文体指針
- 簡潔でリズミカルな文章
- 過剰な比喩は避ける
- 読者が場面を明確に想像できる描写
- キャラクターごとの口調の差別化
- 感情表現は行動と対話で示す

### 執筆プロセス
1. **構想段階**: 作品ディレクトリを作成し、アイデアメモにブレインストーミング
2. **設定作成**: 各作品の設定資料フォルダにキャラクター・世界観の詳細を作成
3. **プロット構築**: プロットフォルダに全体構成と章別概要を作成
4. **本文執筆**: 章ごとにディレクトリを作成し、節単位で執筆・推敲
5. **章内調整**: 各節の流れと章全体の整合性を確認
6. **横断的確認**: 作品全体の整合性と流れを確認

## コマンド

### 基本コマンド
- `novel:start` - 現在の作品での執筆開始
- `novel:character` - キャラクター設定の生成・編集支援
- `novel:plot` - プロット構築支援
- `novel:write` - 本文執筆支援
- `novel:review` - 推敲・校正支援
- `novel:template` - 作品テンプレートの生成

### Obsidian連携コマンド（MCPツール） 
- `list_files_in_vault` - vault全体のファイル一覧表示
- `list_files_in_dir [ディレクトリ]` - 特定ディレクトリのファイル一覧
- `get_file_contents [ファイルパス]` - ファイル内容の読み込み
- `append_content [ファイルパス] [内容]` - ファイルへの追記
- `patch_content [ファイルパス] [位置] [内容]` - 既存ファイルへの挿入
- `search [検索文字列]` - vault内のテキスト検索
- `delete_file [ファイルパス]` - ファイルの削除
- `get_recently_modified` - 最近更新されたファイル一覧

## 小説執筆プロンプトテンプレート

### キャラクター作成
```xml
<character_creation>
  <genre>ジャンル</genre>
  <role>役割（主人公/ヒロイン/敵役など）</role>
  <age>年齢</age>
  <personality>性格・特徴</personality>
  <background>背景・過去</background>
  <motivation>動機・目標</motivation>
  <speech_pattern>口調・話し方の特徴</speech_pattern>
</character_creation>
```

### シーン執筆
```xml
<scene_writing>
  <chapter>章番号</chapter>
  <section>節番号</section>
  <scene_summary>シーンの概要</scene_summary>
  <characters>登場人物</characters>
  <location>場所</location>
  <time>時間帯</time>
  <mood>雰囲気・トーン</mood>
  <word_count>目標文字数（20000-40000）</word_count>
  <key_points>重要な展開</key_points>
  <section_ending>節末の引き</section_ending>
</scene_writing>
```

### 推敲依頼
```xml
<revision_request>
  <focus>重点項目（文章リズム/キャラクター一貫性/描写の密度など）</focus>
  <style>文体の方向性</style>
  <target_reader>想定読者層</target_reader>
  <specific_concerns>特に気になる点</specific_concerns>
</revision_request>
```

## 利用可能なMCPツール

### ファイル操作
- **list_files_in_vault**: vault全体のファイル・ディレクトリ一覧を取得
- **list_files_in_dir**: 特定ディレクトリ内のファイル・ディレクトリ一覧を取得
- **get_file_contents**: 指定ファイルの内容を読み込み
- **append_content**: ファイルの末尾に内容を追記（新規作成も可能）
- **patch_content**: 既存ファイルの特定位置に内容を挿入
- **delete_file**: ファイルまたはディレクトリを削除

### 検索機能
- **search**: vault全体からテキスト検索
- **complex_search**: JsonLogicクエリによる高度な検索（タグ検索など）

### その他の機能
- **get_recently_modified**: 最近更新されたファイルの一覧を取得
- **get_current_periodic_note**: 現在のperiodic noteを取得
- **get_recent_periodic_notes**: 最近のperiodic noteを取得

## 高度な執筆支援機能

### 章と節の管理
各章は複数の節で構成され、以下のような構造を持ちます：
- **節ファイル（第X節.md）**: 実際の本文を含む
- **章メモ（章メモ.md）**: 章全体の管理情報を記録
  - その章で達成すべき物語上の目標
  - 登場人物の心理的変化
  - 重要な伏線の配置
  - 節ごとのあらすじ
  - 次章への引き継ぎ事項

### 節の執筆指針
- 1節あたり7500〜10000文字を目安
- 節の切り替えは場面転換や視点変更のタイミング
- 各節の冒頭で場所・時間・登場人物を明確に
- 節末では次節への興味を引く要素を配置

### 多視点での評価
編集者A（肯定的視点）と編集者B（批判的視点）の二つの立場から作品を評価し、バランスの取れたフィードバックを提供します。

### プロット整合性チェック
- 伏線の管理と回収確認
- キャラクターアークの一貫性
- 時系列の矛盾検出
- 設定の整合性確認
- 節間の流れと章全体の構成確認

### 章構成の管理
- 各章は3〜5節程度で構成
- 起承転結を意識した節配置
- 章の冒頭節で状況設定
- 中間節で展開とクライマックス
- 終節で次章への橋渡し

### スタイル分析
- 文章のリズムパターン分析
- 語彙の多様性評価
- 会話と地の文のバランス
- 場面転換の自然さ

## システムアーキテクチャ

```
graph TD;
    subgraph Docker環境
        ClaudeCLI["Claude CLI<br/>(claudeコンテナ)"] -- "1. 質問" --> MCPObsidian["mcp-obsidian サービス"];
        MCPObsidian -- "2. Vaultの内容を読み取り" --> Vault["(共有ボリューム)<br/>Obsidian Vault"];
        MCPObsidian -- "3. 読み取った内容を<br/>コンテキストとして付与" --> ClaudeCLI;
        ObsidianGUI["obsidian サービス"] -- "メモを編集" --> Vault;
    end
    User[ユーザー] -- "Obsidianで<br/>メモを編集" --> ObsidianGUI;
    User -- "ターミナルで<br/>Claudeに質問" --> ClaudeCLI;
```

## ワークフロー例

### 新規作品の開始
1. Obsidianで新規フォルダ構造を作成（手動またはテンプレート使用）
2. `append_content 小説執筆/[作品名]/作品設定.md [基本情報]` で基本情報を記入
3. `novel:character` でメインキャラクターを作成
4. `novel:plot` で全体構成と章・節構成を検討
5. 第1章のディレクトリを作成
6. 第1章第1節から執筆開始

### 新章の執筆
1. `get_file_contents 小説執筆/[作品名]/プロット/章別概要.md` で該当章の概要を確認
2. `get_file_contents 小説執筆/[作品名]/設定資料/キャラクター設定.md` で登場人物を確認
3. 章のディレクトリを作成し、`章メモ.md`に章の構成を記録
4. `novel:write` で第1節から順に執筆
5. 各節は`append_content 小説執筆/[作品名]/本文/第X章/第Y節.md [執筆内容]` で保存
6. 節の執筆完了ごとに`章メモ.md`を更新
7. 章全体の完成後、`novel:review` で推敲

### 新節の執筆
1. `list_files_in_dir 小説執筆/[作品名]/本文/第X章` で既存の節を確認
2. `get_file_contents 小説執筆/[作品名]/本文/第X章/第Y節.md` で前節の内容を確認
3. `get_file_contents 小説執筆/[作品名]/本文/第X章/章メモ.md` で章の方向性を確認
4. `novel:write` で新節の執筆
5. `append_content 小説執筆/[作品名]/本文/第X章/第Z節.md [執筆内容]` で保存
6. `patch_content 小説執筆/[作品名]/本文/第X章/章メモ.md [位置] [節の概要]` で章メモを更新

### キャラクター対話の作成
1. `get_file_contents 小説執筆/[作品名]/設定資料/キャラクター設定.md` で関連キャラクターを確認
2. 場面設定を明確にする
3. 各キャラクターの口調を維持しながら対話を生成
4. 感情の動きを行動描写で補完
5. 必要に応じて節内の適切な位置に配置

### 作品間の切り替え
1. `list_files_in_dir 小説執筆` で作品一覧を確認
2. `get_file_contents 小説執筆/[作品名]/作品設定.md` で作品の概要を確認
3. 必要な設定資料を読み込んで執筆再開

## 注意事項
- 各章・節の執筆時は、必ず前の節までの内容を`get_file_contents`で確認する
- キャラクターの一貫性維持のため、各作品の設定ファイルは常に最新に保つ
- 作品ごとに独立したディレクトリで管理し、設定の混在を防ぐ
- 定期的にVolumeのバックアップを取る
- 著作権は執筆者に帰属することを明記
- Claude CLIコンテナとmcp-obsidianサービスが同じDockerネットワーク上にあることを確認
- 既存のコンテンツを改善した場合は、改善前のバージョンを上書きするようにすること
- 実行結果はファイルとして残さず、必要に応じて実行結果をファイルとして作成した場合は、その実行の最後に削除する。
- 関係図などの図表は適切な種類のMermaidダイアグラムとして書くこと。
- 本文を執筆するときは、各キャラクターの口調/人称は、設定資料のキャラクター設定を参照してそれに反しないように、執筆してください。
- 本文を書く際は、`Show, don't tell.`の原則を遵守してください。
- **本文を修正した場合は必ずnovel-readerサブエージェントを用いて本文に対するフィードバックを受けることを徹底する。読者の視点から見た小説の品質確保のため、執筆・修正後のフィードバック取得は必須のプロセスとする。**
- **本文を変更した際は必ずnovel-consistency-checkerサブエージェントを用いて設定資料との整合性チェックを行うことを徹底する。設定の矛盾や不整合を防ぐため、本文変更後の整合性確認は必須のプロセスとする。**
- **本文を変更した際は必ずcharacter-voice-validatorサブエージェントを用いてキャラクターの口調や人称の一貫性をチェックすることを徹底する。キャラクターの声の一貫性確保のため、本文変更後のキャラクター音声検証は必須のプロセスとする。**


## プロジェクト固有の設定
各作品のルートディレクトリに`作品設定.md`を作成し、以下の情報を記載してください：
- 作品タイトル：
- ジャンル：
- 想定読者層：
- 目標文字数：
- 1章あたりの節数：
- 1節あたりの文字数：
- 締切：
- 特殊な制約事項：
- 執筆開始日：
- 現在の進捗状況：